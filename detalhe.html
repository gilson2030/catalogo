<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhe do Produto - Rolli Shop</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="detalheProduto" style="max-width:400px;margin:40px auto"></div>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="firebase-config.js"></script>
  <script>
    function isAdmin() {
      return localStorage.getItem('adminLogado') === 'sim';
    }

    // Recupera IDs
    const catId = localStorage.getItem('catId');
    const prodId = localStorage.getItem('prodId');

    if (!catId || !prodId) {
      document.getElementById('detalheProduto').innerHTML = '<p>Produto não encontrado.</p>';
    } else {
      db.collection('categorias').doc(catId).collection('produtos').doc(prodId).get().then(doc=>{
        if(!doc.exists) {
          document.getElementById('detalheProduto').innerHTML = '<p>Produto não encontrado.</p>';
        } else {
          const p = doc.data();
          let html = `
            <h1>${p.nome}</h1>
            <h2 style="color:#ffd600">R$ ${p.preco.toFixed(2)}</h2>
            <p>${p.desc || ''}</p>
          `;
          if (isAdmin()) {
            html += `
              <button onclick="editarProduto()">Editar</button>
              <button onclick="excluirProduto()">Excluir</button>
            `;
          }
          html += `
            <button onclick="compartilharLink()">Compartilhar link</button>
            <button onclick="voltar()">Voltar</button>
          `;
          document.getElementById('detalheProduto').innerHTML = html;
        }
      });
    }

    function editarProduto() {
      alert('Funcionalidade de edição pode ser implementada aqui!');
      // Ou redirecione para um modal ou outra página de edição
    }
    function excluirProduto() {
      if(confirm('Deseja excluir este produto?')) {
        db.collection('categorias').doc(catId).collection('produtos').doc(prodId).delete().then(()=>{
          alert('Produto excluído!');
          window.location.href = "index.html";
        });
      }
    }
    function compartilharLink() {
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: document.title, url });
      } else {
        navigator.clipboard.writeText(url);
        alert('Link copiado!');
      }
    }
    function voltar() {
      window.location.href = "index.html";
    }
  </script>
</body>
</html>

